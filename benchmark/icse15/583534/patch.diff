diff --git a/lucene/java/trunk/src/java/org/apache/lucene/index/ConcurrentMergeScheduler.java b/lucene/java/trunk/src/java/org/apache/lucene/index/ConcurrentMergeScheduler.java
index e2599742..1af151af 100644
--- a/lucene/java/trunk/src/java/org/apache/lucene/index/ConcurrentMergeScheduler.java
+++ b/lucene/java/trunk/src/java/org/apache/lucene/index/ConcurrentMergeScheduler.java
@@ -43,6 +43,15 @@
   private List exceptions = new ArrayList();
   private Directory dir;
 
+  private boolean closed;
+
+  public ConcurrentMergeScheduler() {
+    if (allInstances != null) {
+      // Only for testing
+      addMyself();
+    }
+  }
+
   /** Sets the max # simultaneous threads that may be
    *  running.  If a merge is necessary yet we already have
    *  this many threads running, the merge is returned back
@@ -72,7 +81,7 @@ public synchronized int getMergeThreadPriority() {
   public synchronized void setMergeThreadPriority(int pri) {
     mergeThreadPriority = pri;
 
-    final int numThreads = mergeThreads.size();
+    final int numThreads = mergeThreadCount();
     for(int i=0;i<numThreads;i++) {
       MergeThread merge = (MergeThread) mergeThreads.get(i);
       try {
@@ -84,12 +93,6 @@ public synchronized void setMergeThreadPriority(int pri) {
     }
   }
 
-  /** Returns any exceptions that were caught in the merge
-   *  threads. */
-  public List getExceptions() {
-    return exceptions;
-  }
-
   private void message(String message) {
     System.out.println("CMS [" + Thread.currentThread().getName() + "]: " + message);
   }
@@ -101,10 +104,12 @@ private synchronized void initMergeThreadPriority() {
       mergeThreadPriority = 1+Thread.currentThread().getPriority();
   }
 
-  public void close() {}
+  public void close() {
+    closed = true;
+  }
 
-  private synchronized void finishThreads() {
-    while(mergeThreads.size() > 0) {
+  public synchronized void sync() {
+    while(mergeThreadCount() > 0) {
       if (VERBOSE) {
         message("now wait for threads; currently " + mergeThreads.size() + " still running");
         for(int i=0;i<mergeThreads.size();i++)
@@ -117,20 +122,8 @@ private synchronized void finishThreads() {
       }
     }
   }
-
-  public void sync() {
-    finishThreads();
-  }
-
-  // Used for testing
-  private boolean suppressExceptions;
-
-  /** Used for testing */
-  void setSuppressExceptions() {
-    suppressExceptions = true;
-  }
-  void clearSuppressExceptions() {
-    suppressExceptions = false;
+  private synchronized int mergeThreadCount() {
+    return mergeThreads.size();
   }
 
   public void merge(IndexWriter writer)
@@ -179,7 +172,7 @@ public void merge(IndexWriter writer)
           message("    merge involves segments from an external directory; now run in foreground");
       } else {
         synchronized(this) {
-          if (mergeThreads.size() < maxThreadCount) {
+          if (mergeThreadCount() < maxThreadCount) {
             // OK to spawn a new merge thread to handle this
             // merge:
             MergeThread merger = new MergeThread(writer, merge);
@@ -269,11 +262,13 @@ public void run() {
             exceptions.add(exc);
           }
           
-          if (!suppressExceptions)
+          if (!suppressExceptions) {
             // suppressExceptions is normally only set during
             // testing.
+            anyExceptions = true;
             throw new MergePolicy.MergeException(exc);
         }
+        }
       } finally {
         synchronized(ConcurrentMergeScheduler.this) {
           mergeThreads.remove(this);
@@ -289,4 +284,53 @@ public String toString() {
       return "merge thread: " + merge.segString(dir);
     }
   }
+
+  static boolean anyExceptions = false;
+
+  /** Used for testing */
+  public static boolean anyUnhandledExceptions() {
+    synchronized(allInstances) {
+      final int count = allInstances.size();
+      // Make sure all outstanding threads are done so we see
+      // any exceptions they may produce:
+      for(int i=0;i<count;i++)
+        ((ConcurrentMergeScheduler) allInstances.get(i)).sync();
+      return anyExceptions;
+    }
+  }
+
+  /** Used for testing */
+  private void addMyself() {
+    synchronized(allInstances) {
+      final int size=0;
+      int upto = 0;
+      for(int i=0;i<size;i++) {
+        final ConcurrentMergeScheduler other = (ConcurrentMergeScheduler) allInstances.get(i);
+        if (!(other.closed && 0 == other.mergeThreadCount()))
+          // Keep this one for now: it still has threads or
+          // may spawn new threads
+          allInstances.set(upto++, other);
+      }
+      allInstances.subList(upto, allInstances.size()).clear();
+      allInstances.add(this);
+    }
+  }
+
+  private boolean suppressExceptions;
+
+  /** Used for testing */
+  void setSuppressExceptions() {
+    suppressExceptions = true;
+  }
+
+  /** Used for testing */
+  void clearSuppressExceptions() {
+    suppressExceptions = false;
+  }
+
+  /** Used for testing */
+  private static List allInstances;
+  public static void setTestMode() {
+    allInstances = new ArrayList();
+  }
 }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/TestDemo.java b/lucene/java/trunk/src/test/org/apache/lucene/TestDemo.java
index af479934..541e7309 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/TestDemo.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/TestDemo.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -38,7 +38,7 @@
  * 
  * @author Daniel Naber
  */
-public class TestDemo extends TestCase {
+public class TestDemo extends LuceneTestCase {
 
   public void testDemo() throws IOException, ParseException {
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/TestHitIterator.java b/lucene/java/trunk/src/test/org/apache/lucene/TestHitIterator.java
index 83c882c2..0e847486 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/TestHitIterator.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/TestHitIterator.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.index.Term;
@@ -36,7 +36,7 @@
  * This test intentionally not put in the search package in order
  * to test HitIterator and Hit package protection.
  */
-public class TestHitIterator extends TestCase {
+public class TestHitIterator extends LuceneTestCase {
   public void testIterator() throws Exception {
     RAMDirectory directory = new RAMDirectory();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/TestSearch.java b/lucene/java/trunk/src/test/org/apache/lucene/TestSearch.java
index 1af7dae8..e8cdc337 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/TestSearch.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/TestSearch.java
@@ -21,7 +21,7 @@
 import java.io.PrintWriter;
 import java.io.StringWriter;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 
@@ -36,7 +36,7 @@
  *
  * @version $Id$
  */
-public class TestSearch extends TestCase {
+public class TestSearch extends LuceneTestCase {
 
     /** Main for running test case by itself. */
     public static void main(String args[]) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/TestSearchForDuplicates.java b/lucene/java/trunk/src/test/org/apache/lucene/TestSearchForDuplicates.java
index 0b79935f..8ee5123c 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/TestSearchForDuplicates.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/TestSearchForDuplicates.java
@@ -28,7 +28,7 @@
 import org.apache.lucene.search.*;
 import org.apache.lucene.queryParser.*;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 
@@ -37,7 +37,7 @@
  *
  * @version $Id$
  */
-public class TestSearchForDuplicates extends TestCase {
+public class TestSearchForDuplicates extends LuceneTestCase {
 
     /** Main for running test case by itself. */
     public static void main(String args[]) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestAnalyzers.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestAnalyzers.java
index a33e344b..76725f06 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestAnalyzers.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestAnalyzers.java
@@ -18,9 +18,9 @@
  */
 
 import java.io.*;
-import junit.framework.*;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestAnalyzers extends TestCase {
+public class TestAnalyzers extends LuceneTestCase {
 
    public TestAnalyzers(String name) {
       super(name);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestCachingTokenFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestCachingTokenFilter.java
index 3d752b50..65a34f7f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestCachingTokenFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestCachingTokenFilter.java
@@ -20,7 +20,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -32,7 +32,7 @@
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestCachingTokenFilter extends TestCase {
+public class TestCachingTokenFilter extends LuceneTestCase {
   private String[] tokens = new String[] {"term1", "term2", "term3", "term2"};
   
   public void testCaching() throws IOException {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestISOLatin1AccentFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestISOLatin1AccentFilter.java
index 8abf2aa2..7eaea81d 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestISOLatin1AccentFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestISOLatin1AccentFilter.java
@@ -17,11 +17,11 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.StringReader;
 
-public class TestISOLatin1AccentFilter extends TestCase {
+public class TestISOLatin1AccentFilter extends LuceneTestCase {
   public void testU() throws Exception {
     TokenStream stream = new WhitespaceTokenizer(new StringReader("Des mot clés À LA CHAÎNE À Á Â Ã Ä Å Æ Ç È É Ê Ë Ì Í Î Ï Ð Ñ Ò Ó Ô Õ Ö Ø Œ Þ Ù Ú Û Ü Ý Ÿ à á â ã ä å æ ç è é ê ë ì í î ï ð ñ ò ó ô õ ö ø œ ß þ ù ú û ü ý ÿ"));
     ISOLatin1AccentFilter filter = new ISOLatin1AccentFilter(stream);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestKeywordAnalyzer.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestKeywordAnalyzer.java
index faca40b1..00ddea90 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestKeywordAnalyzer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestKeywordAnalyzer.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.document.Document;
@@ -27,12 +27,13 @@
 import org.apache.lucene.search.Hits;
 import org.apache.lucene.queryParser.QueryParser;
 
-public class TestKeywordAnalyzer extends TestCase {
+public class TestKeywordAnalyzer extends LuceneTestCase {
   
   private RAMDirectory directory;
   private IndexSearcher searcher;
 
   public void setUp() throws Exception {
+    super.setUp();
     directory = new RAMDirectory();
     IndexWriter writer = new IndexWriter(directory,
                                          new SimpleAnalyzer(),
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestLengthFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestLengthFilter.java
index ff6ef221..88bf99f1 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestLengthFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestLengthFilter.java
@@ -17,11 +17,11 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.StringReader;
 
-public class TestLengthFilter extends TestCase {
+public class TestLengthFilter extends LuceneTestCase {
   
   public void testFilter() throws Exception {
     TokenStream stream = new WhitespaceTokenizer(
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestPerFieldAnalzyerWrapper.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestPerFieldAnalzyerWrapper.java
index 30b26096..fc54e467 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestPerFieldAnalzyerWrapper.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestPerFieldAnalzyerWrapper.java
@@ -1,6 +1,6 @@
 package org.apache.lucene.analysis;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.io.StringReader;
 
 /**
@@ -20,7 +20,7 @@
  * limitations under the License.
  */
 
-public class TestPerFieldAnalzyerWrapper extends TestCase {
+public class TestPerFieldAnalzyerWrapper extends LuceneTestCase {
   public void testPerField() throws Exception {
     String text = "Qwerty";
     PerFieldAnalyzerWrapper analyzer =
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStandardAnalyzer.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStandardAnalyzer.java
index c73b79d2..3e9900b6 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStandardAnalyzer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStandardAnalyzer.java
@@ -1,6 +1,6 @@
 package org.apache.lucene.analysis;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 
 import java.io.StringReader;
@@ -21,7 +21,7 @@
  * limitations under the License.
  */
 
-public class TestStandardAnalyzer extends TestCase {
+public class TestStandardAnalyzer extends LuceneTestCase {
 
     private Analyzer a = new StandardAnalyzer();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopAnalyzer.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopAnalyzer.java
index 2f052ea2..12970d0b 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopAnalyzer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopAnalyzer.java
@@ -17,14 +17,14 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.StringReader;
 import java.io.IOException;
 import java.util.Set;
 import java.util.HashSet;
 
-public class TestStopAnalyzer extends TestCase {
+public class TestStopAnalyzer extends LuceneTestCase {
   
   private StopAnalyzer stop = new StopAnalyzer();
   private Set inValidTokens = new HashSet();
@@ -33,7 +33,8 @@ public TestStopAnalyzer(String s) {
     super(s);
   }
 
-  protected void setUp() {
+  protected void setUp() throws Exception {
+    super.setUp();
     for (int i = 0; i < StopAnalyzer.ENGLISH_STOP_WORDS.length; i++) {
       inValidTokens.add(StopAnalyzer.ENGLISH_STOP_WORDS[i]);
     }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopFilter.java
index 32fa1c44..e559db20 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestStopFilter.java
@@ -19,12 +19,12 @@
 import java.io.IOException;
 import java.io.StringReader;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * @author yonik
  */
-public class TestStopFilter extends TestCase {
+public class TestStopFilter extends LuceneTestCase {
 
   // other StopFilter functionality is already tested by TestStopAnalyzer
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestToken.java b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestToken.java
index a95fa321..2e403faf 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestToken.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/analysis/TestToken.java
@@ -18,9 +18,9 @@
  */
 
 import java.io.*;
-import junit.framework.*;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestToken extends TestCase {
+public class TestToken extends LuceneTestCase {
 
   public TestToken(String name) {
     super(name);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/document/TestBinaryDocument.java b/lucene/java/trunk/src/test/org/apache/lucene/document/TestBinaryDocument.java
index 84223aa8..b75800a6 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/document/TestBinaryDocument.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/document/TestBinaryDocument.java
@@ -1,6 +1,6 @@
 package org.apache.lucene.document;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.index.IndexReader;
@@ -30,7 +30,7 @@
  *
  * @version $Id$
  */
-public class TestBinaryDocument extends TestCase
+public class TestBinaryDocument extends LuceneTestCase
 {
 
   String binaryValStored = "this text will be stored as a byte array in the index";
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/document/TestDateTools.java b/lucene/java/trunk/src/test/org/apache/lucene/document/TestDateTools.java
index 4d6e3049..e27d2a52 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/document/TestDateTools.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/document/TestDateTools.java
@@ -6,7 +6,7 @@
 import java.util.Date;
 import java.util.TimeZone;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * Licensed to the Apache Software Foundation (ASF) under one or more
@@ -25,7 +25,7 @@
  * limitations under the License.
  */
 
-public class TestDateTools extends TestCase {
+public class TestDateTools extends LuceneTestCase {
 
   public void testStringToDate() throws ParseException {
     
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/document/TestDocument.java b/lucene/java/trunk/src/test/org/apache/lucene/document/TestDocument.java
index 682ed8aa..ef1d85e3 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/document/TestDocument.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/document/TestDocument.java
@@ -1,6 +1,6 @@
 package org.apache.lucene.document;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.document.Document;
@@ -37,7 +37,7 @@
  *
  * @version $Id$
  */
-public class TestDocument extends TestCase
+public class TestDocument extends LuceneTestCase
 {
 
   String binaryVal = "this text will be stored as a byte array in the index";
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/document/TestNumberTools.java b/lucene/java/trunk/src/test/org/apache/lucene/document/TestNumberTools.java
index 1f6bacc2..695ad1e3 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/document/TestNumberTools.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/document/TestNumberTools.java
@@ -17,9 +17,9 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestNumberTools extends TestCase {
+public class TestNumberTools extends LuceneTestCase {
     public void testNearZero() {
         for (int i = -100; i <= 100; i++) {
             for (int j = -100; j <= 100; j++) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestAddIndexesNoOptimize.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestAddIndexesNoOptimize.java
index 38a03186..70e9c335 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestAddIndexesNoOptimize.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestAddIndexesNoOptimize.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
@@ -29,7 +29,7 @@
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestAddIndexesNoOptimize extends TestCase {
+public class TestAddIndexesNoOptimize extends LuceneTestCase {
   public void testSimpleCase() throws IOException {
     // main directory
     Directory dir = new RAMDirectory();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestAtomicUpdate.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestAtomicUpdate.java
index c2a1d9b6..f6a698cb 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestAtomicUpdate.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestAtomicUpdate.java
@@ -25,12 +25,12 @@
 import org.apache.lucene.queryParser.*;
 import org.apache.lucene.util._TestUtil;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Random;
 import java.io.File;
 
-public class TestAtomicUpdate extends TestCase {
+public class TestAtomicUpdate extends LuceneTestCase {
   private static final Analyzer ANALYZER = new SimpleAnalyzer();
   private static final Random RANDOM = new Random();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestBackwardsCompatibility.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestBackwardsCompatibility.java
index 26933b83..0e65f272 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestBackwardsCompatibility.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestBackwardsCompatibility.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.util.Vector;
 import java.util.Arrays;
 import java.io.ByteArrayOutputStream;
@@ -42,7 +42,7 @@
   against it, and add documents to it.
 */
 
-public class TestBackwardsCompatibility extends TestCase
+public class TestBackwardsCompatibility extends LuceneTestCase
 {
 
   // Uncomment these cases & run in a pre-lockless checkout
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestCompoundFile.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestCompoundFile.java
index e378e4b3..de0b617c 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestCompoundFile.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestCompoundFile.java
@@ -20,7 +20,7 @@
 import java.io.IOException;
 import java.io.File;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 import org.apache.lucene.store.IndexOutput;
@@ -35,7 +35,7 @@
  *
  * @version $Id$
  */
-public class TestCompoundFile extends TestCase
+public class TestCompoundFile extends LuceneTestCase
 {
     /** Main for running test case by itself. */
     public static void main(String args[]) {
@@ -58,7 +58,8 @@ public static void main(String args[]) {
     private Directory dir;
 
 
-    public void setUp() throws IOException {
+    public void setUp() throws Exception {
+       super.setUp();
        File file = new File(System.getProperty("tempDir"), "testIndex");
        _TestUtil.rmDir(file);
        dir = FSDirectory.getDirectory(file);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestConcurrentMergeScheduler.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestConcurrentMergeScheduler.java
index 8d57da8a..5364cf65 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestConcurrentMergeScheduler.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestConcurrentMergeScheduler.java
@@ -28,12 +28,12 @@
 import org.apache.lucene.util._TestUtil;
 import org.apache.lucene.util.English;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 import java.io.File;
 
-public class TestConcurrentMergeScheduler extends TestCase {
+public class TestConcurrentMergeScheduler extends LuceneTestCase {
   
   private static final Analyzer ANALYZER = new SimpleAnalyzer();
 
@@ -94,8 +94,6 @@ public void testFlushExceptions() throws IOException {
       }
     }
 
-    assertEquals(0, cms.getExceptions().size());
-
     writer.close();
     IndexReader reader = IndexReader.open(directory);
     assertEquals(200, reader.numDocs());
@@ -139,8 +137,6 @@ public void testDeleteMerging() throws IOException {
       writer.flush();
     }
 
-    assertEquals(0, cms.getExceptions().size());
-
     writer.close();
     IndexReader reader = IndexReader.open(directory);
     // Verify that we did not lose any deletes...
@@ -171,7 +167,6 @@ public void testNoExtraFiles() throws IOException {
         
         writer.close();
         TestIndexWriter.assertNoUnreferencedFiles(directory, "testNoExtraFiles autoCommit=" + autoCommit);
-        assertEquals(0, cms.getExceptions().size());
 
         // Reopen
         writer = new IndexWriter(directory, autoCommit, ANALYZER, false);
@@ -211,7 +206,6 @@ public void testNoWaitClose() throws IOException {
         }
 
         writer.close(false);
-        assertEquals(0, cms.getExceptions().size());
 
         IndexReader reader = IndexReader.open(directory);
         assertEquals((1+iter)*181, reader.numDocs());
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDeletionPolicy.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDeletionPolicy.java
index 7f1461a7..d7d146d4 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDeletionPolicy.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDeletionPolicy.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 
@@ -40,7 +40,7 @@
   against it, and add documents to it.
 */
 
-public class TestDeletionPolicy extends TestCase
+public class TestDeletionPolicy extends LuceneTestCase
 {
   private void verifyCommitOrder(List commits) {
     long last = SegmentInfos.generationFromSegmentsFileName(((IndexCommitPoint) commits.get(0)).getSegmentsFileName());
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDoc.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDoc.java
index 7b96fbdb..343a3a32 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDoc.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDoc.java
@@ -16,7 +16,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 
@@ -37,7 +37,7 @@
  *
  * @version $Id$
  */
-public class TestDoc extends TestCase {
+public class TestDoc extends LuceneTestCase {
 
     /** Main for running test case by itself. */
     public static void main(String args[]) {
@@ -53,7 +53,8 @@ public static void main(String args[]) {
     /** Set the test case. This test case needs
      *  a few text files created in the current working directory.
      */
-    public void setUp() throws IOException {
+    public void setUp() throws Exception {
+        super.setUp();
         workDir = new File(System.getProperty("tempDir"),"TestDoc");
         workDir.mkdirs();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDocumentWriter.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDocumentWriter.java
index 2d633061..ea596101 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestDocumentWriter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestDocumentWriter.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.analysis.Token;
@@ -34,24 +34,20 @@
 
 import java.util.Arrays;
 
-public class TestDocumentWriter extends TestCase {
+public class TestDocumentWriter extends LuceneTestCase {
   private RAMDirectory dir;
 
   public TestDocumentWriter(String s) {
     super(s);
   }
 
-  protected void setUp() {
+  protected void setUp() throws Exception {
+    super.setUp();
     dir = new RAMDirectory();
   }
 
-  protected void tearDown() {
-
-  }
-
   public void test() {
     assertTrue(dir != null);
-
   }
 
   public void testAddDocument() throws Exception {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldInfos.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldInfos.java
index 1dc52653..aebc3eec 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldInfos.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldInfos.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.store.IndexOutput;
@@ -26,7 +26,7 @@
 
 //import org.cnlp.utils.properties.ResourceBundleHelper;
 
-public class TestFieldInfos extends TestCase {
+public class TestFieldInfos extends LuceneTestCase {
 
   private Document testDoc = new Document();
 
@@ -34,13 +34,11 @@ public TestFieldInfos(String s) {
     super(s);
   }
 
-  protected void setUp() {
+  protected void setUp() throws Exception {
+    super.setUp();
     DocHelper.setupDoc(testDoc);
   }
 
-  protected void tearDown() {
-  }
-
   public void test() throws IOException {
     //Positive test of FieldInfos
     assertTrue(testDoc != null);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldsReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldsReader.java
index 39a1ac60..79454c9c 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldsReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFieldsReader.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.*;
 import org.apache.lucene.search.Similarity;
@@ -30,7 +30,7 @@
 import java.io.IOException;
 import java.util.*;
 
-public class TestFieldsReader extends TestCase {
+public class TestFieldsReader extends LuceneTestCase {
   private RAMDirectory dir = new RAMDirectory();
   private Document testDoc = new Document();
   private FieldInfos fieldInfos = null;
@@ -41,7 +41,8 @@ public TestFieldsReader(String s) {
     super(s);
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     fieldInfos = new FieldInfos();
     DocHelper.setupDoc(testDoc);
     fieldInfos.add(testDoc);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFilterIndexReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFilterIndexReader.java
index 90bae22e..7cd8b52f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestFilterIndexReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestFilterIndexReader.java
@@ -18,7 +18,7 @@
  */
 
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 
@@ -30,7 +30,7 @@
 
 import java.io.IOException;
 
-public class TestFilterIndexReader extends TestCase {
+public class TestFilterIndexReader extends LuceneTestCase {
 
   private static class TestReader extends FilterIndexReader {
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexFileDeleter.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexFileDeleter.java
index e65ee3ec..6a342925 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexFileDeleter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexFileDeleter.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.util.Vector;
 import java.util.Arrays;
 import java.io.ByteArrayOutputStream;
@@ -44,7 +44,7 @@
   against it, and add documents to it.
 */
 
-public class TestIndexFileDeleter extends TestCase
+public class TestIndexFileDeleter extends LuceneTestCase
 {
   public void testDeleteLeftoverFiles() throws IOException {
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexInput.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexInput.java
index 7d511879..d3c727df 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexInput.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexInput.java
@@ -17,12 +17,12 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.IndexInput;
 
 import java.io.IOException;
 
-public class TestIndexInput extends TestCase {
+public class TestIndexInput extends LuceneTestCase {
   public void testRead() throws IOException {
     IndexInput is = new MockIndexInput(new byte[]{(byte) 0x80, 0x01,
             (byte) 0xFF, 0x7F,
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexModifier.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexModifier.java
index d610f2b9..cd89051f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexModifier.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexModifier.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
@@ -42,7 +42,7 @@
  * @author Daniel Naber
  * @deprecated
  */
-public class TestIndexModifier extends TestCase {
+public class TestIndexModifier extends LuceneTestCase {
 
   private int docCount = 0;
   
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexReader.java
index acd288a8..257166f1 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexReader.java
@@ -18,7 +18,7 @@
  */
 
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
@@ -36,7 +36,7 @@
 import java.io.IOException;
 import java.util.*;
 
-public class TestIndexReader extends TestCase
+public class TestIndexReader extends LuceneTestCase
 {
     /** Main for running test case by itself. */
     public static void main(String args[]) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriter.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriter.java
index a1716121..91d9ce25 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriter.java
@@ -22,7 +22,7 @@
 import java.util.Arrays;
 import java.util.Random;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
@@ -50,7 +50,7 @@
  *
  * @version $Id$
  */
-public class TestIndexWriter extends TestCase
+public class TestIndexWriter extends LuceneTestCase
 {
     public void testDocCount() throws IOException
     {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterDelete.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterDelete.java
index 0b876776..d911e467 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterDelete.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterDelete.java
@@ -21,7 +21,7 @@
 import java.util.Arrays;
 import java.lang.StackTraceElement;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
@@ -33,7 +33,7 @@
 import org.apache.lucene.store.MockRAMDirectory;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestIndexWriterDelete extends TestCase {
+public class TestIndexWriterDelete extends LuceneTestCase {
 
   // test the simple case
   public void testSimpleCase() throws IOException {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterLockRelease.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterLockRelease.java
index 04169625..87362497 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterLockRelease.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterLockRelease.java
@@ -20,7 +20,7 @@
 import java.io.File;
 import java.io.FileNotFoundException;
 import java.io.IOException;
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.index.IndexWriter;
 
 /**
@@ -32,10 +32,11 @@
  * @version $Id$
  */
 
-public class TestIndexWriterLockRelease extends TestCase {
+public class TestIndexWriterLockRelease extends LuceneTestCase {
     private java.io.File __test_dir;
 
-    public void setUp() throws IOException {
+    public void setUp() throws Exception {
+        super.setUp();
         if (this.__test_dir == null) {
             String tmp_dir = System.getProperty("java.io.tmpdir", "tmp");
             this.__test_dir = new File(tmp_dir, "testIndexWriter");
@@ -51,7 +52,8 @@ public void setUp() throws IOException {
         }
     }
 
-    public void tearDown() throws IOException {
+    public void tearDown() throws Exception {
+        super.tearDown();
         if (this.__test_dir != null) {
             File[] files = this.__test_dir.listFiles();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMergePolicy.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMergePolicy.java
index 10c35ac2..b696ae06 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMergePolicy.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMergePolicy.java
@@ -26,9 +26,9 @@
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.util._TestUtil;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestIndexWriterMergePolicy extends TestCase {
+public class TestIndexWriterMergePolicy extends LuceneTestCase {
 
   // Test the normal case
   public void testNormalCase() throws IOException {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMerging.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMerging.java
index b6f7a09f..4017683a 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMerging.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestIndexWriterMerging.java
@@ -20,12 +20,12 @@
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 
 
-public class TestIndexWriterMerging extends TestCase
+public class TestIndexWriterMerging extends LuceneTestCase
 {
 
   /**
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyBug.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyBug.java
index 7e75bf3b..1965f64d 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyBug.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyBug.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.*;
@@ -32,7 +32,7 @@
  * Test demonstrating EOF bug on the last field of the last doc 
  * if other docs have allready been accessed.
  */
-public class TestLazyBug extends TestCase {
+public class TestLazyBug extends LuceneTestCase {
 
   public static int BASE_SEED = 13;
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyProxSkipping.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyProxSkipping.java
index abdfe216..229241bb 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyProxSkipping.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestLazyProxSkipping.java
@@ -30,13 +30,13 @@
 import org.apache.lucene.store.IndexInput;
 import org.apache.lucene.store.RAMDirectory;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * Tests lazy skipping on the proximity file.
  *
  */
-public class TestLazyProxSkipping extends TestCase {
+public class TestLazyProxSkipping extends LuceneTestCase {
     private Searcher searcher;
     private int seeksCounter = 0;
     
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiLevelSkipList.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiLevelSkipList.java
index 2c2300ce..30aaaef4 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiLevelSkipList.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiLevelSkipList.java
@@ -20,7 +20,7 @@
 import java.io.IOException;
 import java.io.Reader;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.LowerCaseTokenizer;
@@ -42,7 +42,7 @@
  * testcases.
  * 
  */
-public class TestMultiLevelSkipList extends TestCase {
+public class TestMultiLevelSkipList extends LuceneTestCase {
   public void testSimpleSkip() throws IOException {
     RAMDirectory dir = new RAMDirectory();
     IndexWriter writer = new IndexWriter(dir, new PayloadAnalyzer(), true);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiSegmentReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiSegmentReader.java
index 95675c86..c85d678d 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiSegmentReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestMultiSegmentReader.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -27,7 +27,7 @@
 
 import java.io.IOException;
 
-public class TestMultiSegmentReader extends TestCase {
+public class TestMultiSegmentReader extends LuceneTestCase {
   protected Directory dir;
   private Document doc1;
   private Document doc2;
@@ -39,7 +39,8 @@ public TestMultiSegmentReader(String s) {
     super(s);
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     dir = new RAMDirectory();
     doc1 = new Document();
     doc2 = new Document();
@@ -63,7 +64,7 @@ protected IndexReader openReader() throws IOException {
     return reader;
   }
 
-  public void test() throws IOException {
+  public void test() throws Exception {
     setUp();
     doTestDocument();
     doTestUndeleteAll();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestNorms.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestNorms.java
index 3a84faf6..1b662690 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestNorms.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestNorms.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
@@ -38,7 +38,7 @@
  * Test that norms info is preserved during index life - including
  * separate norms, addDocument, addIndexes, optimize.
  */
-public class TestNorms extends TestCase {
+public class TestNorms extends LuceneTestCase {
 
   private class SimilarityOne extends DefaultSimilarity {
     public float lengthNorm(String fieldName, int numTerms) {
@@ -60,14 +60,12 @@ public TestNorms(String s) {
     super(s);
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     similarityOne = new SimilarityOne();
     anlzr = new StandardAnalyzer();
   }
 
-  protected void tearDown() throws IOException {
-  }
-
   /**
    * Test that norms values are preserved as the index is maintained.
    * Including separate norms.
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelReader.java
index 39dd154c..a813b74a 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelReader.java
@@ -21,7 +21,7 @@
 import java.util.Arrays;
 import java.util.Collection;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -38,12 +38,13 @@
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.store.MockRAMDirectory;
 
-public class TestParallelReader extends TestCase {
+public class TestParallelReader extends LuceneTestCase {
 
   private Searcher parallel;
   private Searcher single;
   
   protected void setUp() throws Exception {
+    super.setUp();
     single = single();
     parallel = parallel();
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelTermEnum.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelTermEnum.java
index 6d4d8a69..573428cc 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelTermEnum.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestParallelTermEnum.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
@@ -28,11 +28,12 @@
 import org.apache.lucene.document.Field.Store;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestParallelTermEnum extends TestCase {
+public class TestParallelTermEnum extends LuceneTestCase {
     private IndexReader ir1;
     private IndexReader ir2;
 
     protected void setUp() throws Exception {
+        super.setUp();
         super.setUp();
         Document doc;
 
@@ -67,6 +68,7 @@ protected void setUp() throws Exception {
 
     protected void tearDown() throws Exception {
         super.tearDown();
+        super.tearDown();
 
         ir1.close();
         ir2.close();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestPayloads.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestPayloads.java
index 4a08cbfa..116415e2 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestPayloads.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestPayloads.java
@@ -26,7 +26,7 @@
 import java.util.Map;
 import java.util.Random;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.Token;
@@ -41,7 +41,7 @@
 import org.apache.lucene.store.RAMDirectory;
 
 
-public class TestPayloads extends TestCase {
+public class TestPayloads extends LuceneTestCase {
     
     // Simple tests to test the Payload class
     public void testPayload() throws Exception {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestPositionBasedTermVectorMapper.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestPositionBasedTermVectorMapper.java
index 9fb9ba2f..06adf0db 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestPositionBasedTermVectorMapper.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestPositionBasedTermVectorMapper.java
@@ -15,14 +15,14 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 import java.util.BitSet;
 import java.util.Iterator;
 import java.util.Map;
 
-public class TestPositionBasedTermVectorMapper extends TestCase {
+public class TestPositionBasedTermVectorMapper extends LuceneTestCase {
   protected String[] tokens;
   protected int[][] thePositions;
   protected TermVectorOffsetInfo[][] offsets;
@@ -33,7 +33,8 @@ public TestPositionBasedTermVectorMapper(String s) {
     super(s);
   }
 
-  protected void setUp() {
+  protected void setUp() throws Exception {
+    super.setUp();
     tokens = new String[]{"here", "is", "some", "text", "to", "test", "extra"};
     thePositions = new int[tokens.length][];
     offsets = new TermVectorOffsetInfo[tokens.length][];
@@ -57,10 +58,6 @@ protected void setUp() {
     offsets[tokens.length - 1][0] = new TermVectorOffsetInfo(0, 1);
   }
 
-  protected void tearDown() {
-
-  }
-
   public void test() throws IOException {
     PositionBasedTermVectorMapper mapper = new PositionBasedTermVectorMapper();
     
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentMerger.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentMerger.java
index 3fdb7aa4..033d0e53 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentMerger.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentMerger.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.document.Document;
@@ -25,7 +25,7 @@
 import java.io.IOException;
 import java.util.Collection;
 
-public class TestSegmentMerger extends TestCase {
+public class TestSegmentMerger extends LuceneTestCase {
   //The variables for the new merged segment
   private Directory mergedDir = new RAMDirectory();
   private String mergedSegment = "test";
@@ -43,7 +43,8 @@ public TestSegmentMerger(String s) {
     super(s);
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     DocHelper.setupDoc(doc1);
     SegmentInfo info1 = DocHelper.writeDoc(merge1Dir, doc1);
     DocHelper.setupDoc(doc2);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentReader.java
index 48df3f80..c952746b 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentReader.java
@@ -22,14 +22,14 @@
 import java.util.Iterator;
 import java.util.List;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Fieldable;
 import org.apache.lucene.search.DefaultSimilarity;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestSegmentReader extends TestCase {
+public class TestSegmentReader extends LuceneTestCase {
   private RAMDirectory dir = new RAMDirectory();
   private Document testDoc = new Document();
   private SegmentReader reader = null;
@@ -39,16 +39,13 @@ public TestSegmentReader(String s) {
   }
   
   //TODO: Setup the reader w/ multiple documents
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     DocHelper.setupDoc(testDoc);
     SegmentInfo info = DocHelper.writeDoc(dir, testDoc);
     reader = SegmentReader.get(info);
   }
 
-  protected void tearDown() {
-
-  }
-
   public void test() {
     assertTrue(dir != null);
     assertTrue(reader != null);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermDocs.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermDocs.java
index b00d7013..a13f8e5d 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermDocs.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermDocs.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
@@ -26,7 +26,7 @@
 
 import java.io.IOException;
 
-public class TestSegmentTermDocs extends TestCase {
+public class TestSegmentTermDocs extends LuceneTestCase {
   private Document testDoc = new Document();
   private Directory dir = new RAMDirectory();
   private SegmentInfo info;
@@ -35,16 +35,12 @@ public TestSegmentTermDocs(String s) {
     super(s);
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     DocHelper.setupDoc(testDoc);
     info = DocHelper.writeDoc(dir, testDoc);
   }
 
-
-  protected void tearDown() {
-
-  }
-
   public void test() {
     assertTrue(dir != null);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermEnum.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermEnum.java
index c661de4d..885d060f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermEnum.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestSegmentTermEnum.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
@@ -34,7 +34,7 @@
 /**
  * @author goller
  */
-public class TestSegmentTermEnum extends TestCase
+public class TestSegmentTermEnum extends LuceneTestCase
 {
   Directory dir = new RAMDirectory();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestStressIndexing.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestStressIndexing.java
index 3f3b4b04..0f9868ec 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestStressIndexing.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestStressIndexing.java
@@ -24,12 +24,12 @@
 import org.apache.lucene.search.*;
 import org.apache.lucene.queryParser.*;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Random;
 import java.io.File;
 
-public class TestStressIndexing extends TestCase {
+public class TestStressIndexing extends LuceneTestCase {
   private static final Analyzer ANALYZER = new SimpleAnalyzer();
   private static final Random RANDOM = new Random();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTerm.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTerm.java
index d151cb34..57ce23d7 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTerm.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTerm.java
@@ -17,9 +17,9 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestTerm extends TestCase {
+public class TestTerm extends LuceneTestCase {
 
   public void testEquals() {
     final Term base = new Term("same", "same");
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermVectorsReader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermVectorsReader.java
index 79cef59b..35f1f4d3 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermVectorsReader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermVectorsReader.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.MockRAMDirectory;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.TokenStream;
@@ -32,7 +32,7 @@
 import java.util.Map;
 import java.util.SortedSet;
 
-public class TestTermVectorsReader extends TestCase {
+public class TestTermVectorsReader extends LuceneTestCase {
   //Must be lexicographically sorted, will do in setup, versus trying to maintain here
   private String[] testFields = {"f1", "f2", "f3", "f4"};
   private boolean[] testFieldsStorePos = {true, false, true, false};
@@ -61,7 +61,8 @@ public int compareTo(Object other) {
 
   TestToken[] tokens = new TestToken[testTerms.length * TERM_FREQ];
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     /*
     for (int i = 0; i < testFields.length; i++) {
       fieldInfos.add(testFields[i], true, true, testFieldsStorePos[i], testFieldsStoreOff[i]);
@@ -141,10 +142,6 @@ public TokenStream tokenStream(String fieldName, Reader reader) {
     }
   }
 
-  protected void tearDown() {
-
-  }
-
   public void test() {
     //Check to see the files were created properly in setup
     assertTrue(dir.fileExists(seg + "." + IndexFileNames.VECTORS_DOCUMENTS_EXTENSION));
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermdocPerf.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermdocPerf.java
index 60be77ec..f1f6484e 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermdocPerf.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestTermdocPerf.java
@@ -17,7 +17,7 @@
  */
 
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.analysis.Analyzer;
@@ -49,7 +49,7 @@ public Token next() throws IOException {
 }
 
 
-public class TestTermdocPerf extends TestCase {
+public class TestTermdocPerf extends LuceneTestCase {
 
   void addDocs(Directory dir, final int ndocs, String field, final String val, final int maxTF, final float percentDocs) throws IOException {
     final Random random = new Random(0);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestThreadedOptimize.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestThreadedOptimize.java
index 0985b1ca..5ee7a76f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestThreadedOptimize.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestThreadedOptimize.java
@@ -27,12 +27,12 @@
 import org.apache.lucene.util._TestUtil;
 import org.apache.lucene.util.English;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 import java.io.File;
 
-public class TestThreadedOptimize extends TestCase {
+public class TestThreadedOptimize extends LuceneTestCase {
   
   private static final Analyzer ANALYZER = new SimpleAnalyzer();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/TestWordlistLoader.java b/lucene/java/trunk/src/test/org/apache/lucene/index/TestWordlistLoader.java
index a6ca6597..a59f38b9 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/TestWordlistLoader.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/TestWordlistLoader.java
@@ -22,11 +22,11 @@
 import java.io.StringReader;
 import java.util.HashSet;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WordlistLoader;
 
-public class TestWordlistLoader extends TestCase {
+public class TestWordlistLoader extends LuceneTestCase {
 
   public void testWordlistLoading() throws IOException {
     String s = "ONE\n  two \nthree";
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/index/store/TestRAMDirectory.java b/lucene/java/trunk/src/test/org/apache/lucene/index/store/TestRAMDirectory.java
index 6bd36906..9456f6c0 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/index/store/TestRAMDirectory.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/index/store/TestRAMDirectory.java
@@ -24,7 +24,7 @@
 import java.io.ByteArrayOutputStream;
 
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
@@ -47,7 +47,7 @@
  * 
  * @version $Id: RAMDirectory.java 150537 2004-09-28 22:45:26 +0200 (Di, 28 Sep 2004) cutting $
  */
-public class TestRAMDirectory extends TestCase {
+public class TestRAMDirectory extends LuceneTestCase {
   
   private File indexDir = null;
   
@@ -55,7 +55,8 @@
   private final int docsToAdd = 500;
   
   // setup the index
-  public void setUp () throws IOException {
+  public void setUp () throws Exception {
+    super.setUp();
     String tempDir = System.getProperty("java.io.tmpdir");
     if (tempDir == null)
       throw new IOException("java.io.tmpdir undefined, cannot run test");
@@ -206,7 +207,8 @@ public void testSerializable() throws IOException {
     assertTrue("contains more then just header", headerSize < bos.size());
   } 
 
-  public void tearDown() {
+  public void tearDown() throws Exception {
+    super.tearDown();
     // cleanup 
     if (indexDir != null && indexDir.exists()) {
       rmDir (indexDir);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiAnalyzer.java b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiAnalyzer.java
index e6e1d86d..5126c150 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiAnalyzer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiAnalyzer.java
@@ -19,7 +19,7 @@
 
 import java.io.Reader;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.search.Query;
 import org.apache.lucene.analysis.Analyzer;
@@ -36,7 +36,7 @@
  * 
  * @author Daniel Naber
  */
-public class TestMultiAnalyzer extends TestCase {
+public class TestMultiAnalyzer extends LuceneTestCase {
 
   private static int multiToken = 0;
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiFieldQueryParser.java b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiFieldQueryParser.java
index 934f5b16..19e35dea 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiFieldQueryParser.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestMultiFieldQueryParser.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.Token;
 import org.apache.lucene.analysis.TokenStream;
@@ -42,7 +42,7 @@
  * Tests QueryParser.
  * @author Daniel Naber
  */
-public class TestMultiFieldQueryParser extends TestCase {
+public class TestMultiFieldQueryParser extends LuceneTestCase {
 
   /** test stop words arsing for both the non static form, and for the 
    * corresponding static form (qtxt, fields[]). */
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestQueryParser.java b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestQueryParser.java
index 7a7f1edd..3c8eb69e 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestQueryParser.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/queryParser/TestQueryParser.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.*;
 import org.apache.lucene.analysis.Token;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
@@ -40,7 +40,7 @@
 /**
  * Tests QueryParser.
  */
-public class TestQueryParser extends TestCase {
+public class TestQueryParser extends LuceneTestCase {
 
   public static Analyzer qpAnalyzer = new QPTestAnalyzer();
 
@@ -98,7 +98,8 @@ protected Query getWildcardQuery(String field, String termStr) throws ParseExcep
 
   private int originalMaxClauses;
 
-  public void setUp() {
+  public void setUp() throws Exception {
+    super.setUp();
     originalMaxClauses = BooleanQuery.getMaxClauseCount();
   }
 
@@ -861,7 +862,8 @@ private static void addDateDoc(String content, int year, int month,
     iw.addDocument(d);
   }
 
-  public void tearDown() {
+  public void tearDown() throws Exception {
+    super.tearDown();
     BooleanQuery.setMaxClauseCount(originalMaxClauses);
   }
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/BaseTestRangeFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/BaseTestRangeFilter.java
index 6030fcf6..428b1064 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/BaseTestRangeFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/BaseTestRangeFilter.java
@@ -19,7 +19,7 @@
 
 import java.util.Random;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
@@ -27,7 +27,7 @@
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.store.RAMDirectory;
 
-public class BaseTestRangeFilter extends TestCase {
+public class BaseTestRangeFilter extends LuceneTestCase {
 
     public static final boolean F = false;
     public static final boolean T = true;
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBoolean2.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBoolean2.java
index 8b36a6ab..9ea62054 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBoolean2.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBoolean2.java
@@ -31,19 +31,20 @@
 import org.apache.lucene.queryParser.QueryParser;
 import org.apache.lucene.queryParser.ParseException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Random;
 
 /** Test BooleanQuery2 against BooleanQuery by overriding the standard query parser.
  * This also tests the scoring order of BooleanQuery.
  */
-public class TestBoolean2 extends TestCase {
+public class TestBoolean2 extends LuceneTestCase {
   private IndexSearcher searcher;
 
   public static final String field = "field";
 
   public void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     IndexWriter writer= new IndexWriter(directory, new WhitespaceAnalyzer(), true);
     for (int i = 0; i < docFields.length; i++) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanMinShouldMatch.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanMinShouldMatch.java
index d1146d41..b7ebce6a 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanMinShouldMatch.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanMinShouldMatch.java
@@ -19,6 +19,7 @@
 
 
 import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -33,7 +34,7 @@
 
 /** Test that BooleanQuery.setMinimumNumberShouldMatch works.
  */
-public class TestBooleanMinShouldMatch extends TestCase {
+public class TestBooleanMinShouldMatch extends LuceneTestCase {
 
 
     public Directory index;
@@ -43,6 +44,9 @@
     public void setUp() throws Exception {
 
 
+        super.setUp();
+
+
         String[] data = new String [] {
             "A 1 2 3 4 5 6",
             "Z       4 5 6",
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanOr.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanOr.java
index 4629481d..4cfdaab5 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanOr.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanOr.java
@@ -17,7 +17,7 @@
  */
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -36,7 +36,7 @@
  * <br>Adapted to Lucene testcase by Paul Elschot.
  * @author appler@gmail.com
  */
-public class TestBooleanOr extends TestCase {
+public class TestBooleanOr extends LuceneTestCase {
 
 	private static String FIELD_T = "T";
 	private static String FIELD_C = "C";
@@ -134,6 +134,7 @@ public void testParenthesisShould() throws IOException {
 
 	protected void setUp() throws Exception {
 		super.setUp();
+		super.setUp();
 
 		//
 		RAMDirectory rd = new RAMDirectory();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanPrefixQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanPrefixQuery.java
index be0ffb0a..ae3bbaa3 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanPrefixQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanPrefixQuery.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import junit.framework.Test;
 import junit.framework.TestSuite;
 import junit.textui.TestRunner;
@@ -39,7 +39,7 @@
  * @version $Id$
  **/
 
-public class TestBooleanPrefixQuery extends TestCase {
+public class TestBooleanPrefixQuery extends LuceneTestCase {
 
   public static void main(String[] args) {
     TestRunner.run(suite());
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanQuery.java
index 69a2dcb3..13b06210 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanQuery.java
@@ -17,10 +17,10 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.index.Term;
 
-public class TestBooleanQuery extends TestCase {
+public class TestBooleanQuery extends LuceneTestCase {
   
   public void testEquality() throws Exception {
     BooleanQuery bq1 = new BooleanQuery();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanScorer.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanScorer.java
index a9e91347..479f70c4 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanScorer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestBooleanScorer.java
@@ -26,13 +26,13 @@
 import org.apache.lucene.index.Term;
 import org.apache.lucene.store.RAMDirectory;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  *
  * @version $rcs = ' $Id$ ' ;
  */
-public class TestBooleanScorer extends TestCase
+public class TestBooleanScorer extends LuceneTestCase
 {
 
   public TestBooleanScorer(String name) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestCachingWrapperFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestCachingWrapperFilter.java
index 4562ccd4..ae552d76 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestCachingWrapperFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestCachingWrapperFilter.java
@@ -17,14 +17,14 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.index.IndexReader;
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 
-public class TestCachingWrapperFilter extends TestCase {
+public class TestCachingWrapperFilter extends LuceneTestCase {
   public void testCachingWorks() throws Exception {
     Directory dir = new RAMDirectory();
     IndexWriter writer = new IndexWriter(dir, new StandardAnalyzer(), true);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDateFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDateFilter.java
index 3d73c2b5..dc8d4eac 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDateFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDateFilter.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.DateTools;
 import org.apache.lucene.document.Document;
@@ -35,7 +35,7 @@
   * @version $Revision$
   */
 public class TestDateFilter
-    extends TestCase
+    extends LuceneTestCase
 {
     public TestDateFilter(String name)
     {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDisjunctionMaxQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDisjunctionMaxQuery.java
index fb5b1ee1..cefb3c51 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDisjunctionMaxQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDisjunctionMaxQuery.java
@@ -18,7 +18,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -35,7 +35,7 @@
  * Test of the DisjunctionMaxQuery.
  *
  */
-public class TestDisjunctionMaxQuery extends TestCase{
+public class TestDisjunctionMaxQuery extends LuceneTestCase{
 
     /** threshold for comparing floats */
     public static final float SCORE_COMP_THRESH = 0.0000f;
@@ -73,6 +73,8 @@ public float idf(int docFreq, int numDocs) {
 
     public void setUp() throws Exception {
 
+        super.setUp();
+
         index = new RAMDirectory();
         IndexWriter writer = new IndexWriter(index,
                                              new WhitespaceAnalyzer(),
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDocBoost.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDocBoost.java
index a7983e7a..f2b3705e 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestDocBoost.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestDocBoost.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.*;
 import org.apache.lucene.index.IndexWriter;
@@ -29,7 +29,7 @@
  *
  * @version $Revision$
  */
-public class TestDocBoost extends TestCase {
+public class TestDocBoost extends LuceneTestCase {
   public TestDocBoost(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestExplanations.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestExplanations.java
index 53ddb2ea..ec7f6609 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestExplanations.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestExplanations.java
@@ -32,7 +32,7 @@
 import org.apache.lucene.queryParser.QueryParser;
 import org.apache.lucene.queryParser.ParseException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Random;
 import java.util.BitSet;
@@ -49,7 +49,7 @@
  *
  * @see "Subclasses for actual tests"
  */
-public class TestExplanations extends TestCase {
+public class TestExplanations extends LuceneTestCase {
   protected IndexSearcher searcher;
 
   public static final String FIELD = "field";
@@ -57,10 +57,12 @@
     new QueryParser(FIELD, new WhitespaceAnalyzer());
 
   public void tearDown() throws Exception {
+    super.tearDown();
     searcher.close();
   }
   
   public void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     IndexWriter writer= new IndexWriter(directory, new WhitespaceAnalyzer(), true);
     for (int i = 0; i < docFields.length; i++) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestFuzzyQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestFuzzyQuery.java
index 61e5f2fb..81df1fa2 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestFuzzyQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestFuzzyQuery.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -32,7 +32,7 @@
  *
  * @author Daniel Naber
  */
-public class TestFuzzyQuery extends TestCase {
+public class TestFuzzyQuery extends LuceneTestCase {
 
   public void testFuzziness() throws Exception {
     RAMDirectory directory = new RAMDirectory();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMatchAllDocsQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMatchAllDocsQuery.java
index 7884a1c9..ba7c9bfd 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMatchAllDocsQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMatchAllDocsQuery.java
@@ -25,14 +25,14 @@
 import org.apache.lucene.index.Term;
 import org.apache.lucene.store.RAMDirectory;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * Tests MatchAllDocsQuery.
  * 
  * @author Daniel Naber
  */
-public class TestMatchAllDocsQuery extends TestCase {
+public class TestMatchAllDocsQuery extends LuceneTestCase {
 
   public void testQuery() throws IOException {
     RAMDirectory dir = new RAMDirectory();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiPhraseQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiPhraseQuery.java
index e13ef7b8..a250da54 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiPhraseQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiPhraseQuery.java
@@ -28,7 +28,7 @@
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 import java.util.LinkedList;
@@ -39,7 +39,7 @@
  *
  * @version $Id$
  */
-public class TestMultiPhraseQuery extends TestCase
+public class TestMultiPhraseQuery extends LuceneTestCase
 {
     public TestMultiPhraseQuery(String name) {
         super(name);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcher.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcher.java
index 514ad4f7..6ded7a89 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcher.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcher.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.KeywordAnalyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -41,7 +41,7 @@
  *
  * @version $Id$
  */
-public class TestMultiSearcher extends TestCase
+public class TestMultiSearcher extends LuceneTestCase
 {
     public TestMultiSearcher(String name)
     {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcherRanking.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcherRanking.java
index 7543e2a0..1c75790f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcherRanking.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiSearcherRanking.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -35,7 +35,7 @@
  *
  * @version $Id: TestMultiSearcher.java 150492 2004-09-06 22:01:49Z dnaber $
  */
-public class TestMultiSearcherRanking extends TestCase {
+public class TestMultiSearcherRanking extends LuceneTestCase {
   
   private final boolean verbose = false;  // set to true to output hits
   private final String FIELD_NAME = "body";
@@ -111,6 +111,7 @@ private void checkQuery(String queryStr) throws IOException, ParseException {
    * initializes multiSearcher and singleSearcher with the same document set
    */
   protected void setUp() throws Exception {
+    super.setUp();
     // create MultiSearcher from two seperate searchers
     Directory d1 = new RAMDirectory();
     IndexWriter iw1 = new IndexWriter(d1, new StandardAnalyzer(), true);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiThreadTermVectors.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiThreadTermVectors.java
index 8572c6a0..2c4aef36 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiThreadTermVectors.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestMultiThreadTermVectors.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.*;
 import org.apache.lucene.index.IndexReader;
@@ -32,7 +32,7 @@
  *
  * @version $rcs = ' $Id$ ' ;
  */
-public class TestMultiThreadTermVectors extends TestCase {
+public class TestMultiThreadTermVectors extends LuceneTestCase {
   private RAMDirectory directory = new RAMDirectory();
   public int numDocs = 100;
   public int numThreads = 3;
@@ -42,6 +42,7 @@ public TestMultiThreadTermVectors(String s) {
   }
   
   public void setUp() throws Exception {
+    super.setUp();
     IndexWriter writer
             = new IndexWriter(directory, new SimpleAnalyzer(), true);
     //writer.setUseCompoundFile(false);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestNot.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestNot.java
index 1f6662c2..566345c5 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestNot.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestNot.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.queryParser.QueryParser;
@@ -31,7 +31,7 @@
  *
  * @version $Revision$
  */
-public class TestNot extends TestCase {
+public class TestNot extends LuceneTestCase {
   public TestNot(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhrasePrefixQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhrasePrefixQuery.java
index 95fb7d5b..5d8674e1 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhrasePrefixQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhrasePrefixQuery.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -37,7 +37,7 @@
  * @version $Id$
  */
 public class TestPhrasePrefixQuery
-    extends TestCase
+    extends LuceneTestCase
 {
     public TestPhrasePrefixQuery(String name)
     {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhraseQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhraseQuery.java
index 4e6bdcd1..7b4fad98 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhraseQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPhraseQuery.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.*;
 import org.apache.lucene.document.*;
 import org.apache.lucene.index.IndexWriter;
@@ -34,7 +34,7 @@
  * @see TestPositionIncrement
  * @author Erik Hatcher
  */
-public class TestPhraseQuery extends TestCase {
+public class TestPhraseQuery extends LuceneTestCase {
 
   /** threshold for comparing floats */
   public static final float SCORE_COMP_THRESH = 1e-6f;
@@ -44,6 +44,7 @@
   private RAMDirectory directory;
 
   public void setUp() throws Exception {
+    super.setUp();
     directory = new RAMDirectory();
     Analyzer analyzer = new Analyzer() {
       public TokenStream tokenStream(String fieldName, Reader reader) {
@@ -80,6 +81,7 @@ public int getPositionIncrementGap(String fieldName) {
   }
 
   public void tearDown() throws Exception {
+    super.tearDown();
     searcher.close();
     directory.close();
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPositionIncrement.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPositionIncrement.java
index b36b74a4..5d12b03b 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPositionIncrement.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPositionIncrement.java
@@ -33,7 +33,7 @@
 import java.io.Reader;
 import java.io.StringReader;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * Term position unit test.
@@ -41,7 +41,7 @@
  *
  * @version $Revision$
  */
-public class TestPositionIncrement extends TestCase {
+public class TestPositionIncrement extends LuceneTestCase {
 
   public void testSetPosition() throws Exception {
     Analyzer analyzer = new Analyzer() {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixFilter.java
index 794e7dc3..e2dd60ac 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixFilter.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.index.Term;
@@ -31,7 +31,7 @@
  * @author Yura Smolsky
  * @author yonik
  */
-public class TestPrefixFilter extends TestCase {
+public class TestPrefixFilter extends LuceneTestCase {
   public void testPrefixFilter() throws Exception {
     RAMDirectory directory = new RAMDirectory();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixQuery.java
index 17a6cf28..54ec8271 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestPrefixQuery.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.index.IndexWriter;
 import org.apache.lucene.index.Term;
@@ -30,7 +30,7 @@
  *
  * @author Erik Hatcher
  */
-public class TestPrefixQuery extends TestCase {
+public class TestPrefixQuery extends LuceneTestCase {
   public void testPrefixQuery() throws Exception {
     RAMDirectory directory = new RAMDirectory();
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestQueryTermVector.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestQueryTermVector.java
index 7022dd02..bd9380cb 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestQueryTermVector.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestQueryTermVector.java
@@ -17,23 +17,16 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 
-public class TestQueryTermVector extends TestCase {
+public class TestQueryTermVector extends LuceneTestCase {
 
 
   public TestQueryTermVector(String s) {
     super(s);
   }
 
-  protected void setUp() {
-  }
-
-  protected void tearDown() {
-
-  }
-
   public void testConstructor() {
     String [] queryTerm = {"foo", "bar", "foo", "again", "foo", "bar", "go", "go", "go"};
     //Items are sorted lexicographically
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRangeQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRangeQuery.java
index 7eebae4d..f530e0ac 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRangeQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRangeQuery.java
@@ -24,18 +24,19 @@
 import org.apache.lucene.index.Term;
 import org.apache.lucene.store.RAMDirectory;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.io.IOException;
 
 /**
  * @author goller
  */
-public class TestRangeQuery extends TestCase {
+public class TestRangeQuery extends LuceneTestCase {
 
   private int docCount = 0;
   private RAMDirectory dir;
 
-  public void setUp() {
+  public void setUp() throws Exception {
+    super.setUp();
     dir = new RAMDirectory();
   }
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteCachingWrapperFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteCachingWrapperFilter.java
index e3d12927..99058b10 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteCachingWrapperFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteCachingWrapperFilter.java
@@ -20,7 +20,7 @@
 import java.rmi.Naming;
 import java.rmi.registry.LocateRegistry;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
@@ -34,7 +34,7 @@
  * NOTE: This is copied from TestRemoteSearchable since it already had a remote index set up.
  * @author Matt Ericson
  */
-public class TestRemoteCachingWrapperFilter extends TestCase {
+public class TestRemoteCachingWrapperFilter extends LuceneTestCase {
   public TestRemoteCachingWrapperFilter(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteSearchable.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteSearchable.java
index 50009440..63b463c3 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteSearchable.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestRemoteSearchable.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.*;
 import org.apache.lucene.index.IndexWriter;
@@ -33,7 +33,7 @@
 /**
  * @version $Id$
  */
-public class TestRemoteSearchable extends TestCase {
+public class TestRemoteSearchable extends LuceneTestCase {
   public TestRemoteSearchable(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestScorerPerf.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestScorerPerf.java
index 143ad4d4..4eee43a8 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestScorerPerf.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestScorerPerf.java
@@ -1,6 +1,6 @@
 package org.apache.lucene.search;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Random;
 import java.util.BitSet;
@@ -37,7 +37,7 @@
  *
  * @version $Id$
  */
-public class TestScorerPerf extends TestCase {
+public class TestScorerPerf extends LuceneTestCase {
   Random r = new Random(0);
   boolean validate = true;  // set to false when doing performance testing
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSetNorm.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSetNorm.java
index d46f2c65..604f5162 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSetNorm.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSetNorm.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.*;
 import org.apache.lucene.index.IndexReader;
@@ -30,7 +30,7 @@
  *
  * @version $Revision$
  */
-public class TestSetNorm extends TestCase {
+public class TestSetNorm extends LuceneTestCase {
   public TestSetNorm(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSimilarity.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSimilarity.java
index 1d502a07..cf9539f5 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSimilarity.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSimilarity.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Collection;
 
@@ -34,7 +34,7 @@
  *
  * @version $Revision$
  */
-public class TestSimilarity extends TestCase {
+public class TestSimilarity extends LuceneTestCase {
   public TestSimilarity(String name) {
     super(name);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSpanQueryFilter.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSpanQueryFilter.java
index f1dff30f..aa04f227 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestSpanQueryFilter.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestSpanQueryFilter.java
@@ -16,7 +16,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -32,20 +32,13 @@
 import java.util.Iterator;
 import java.util.List;
 
-public class TestSpanQueryFilter extends TestCase {
+public class TestSpanQueryFilter extends LuceneTestCase {
 
 
   public TestSpanQueryFilter(String s) {
     super(s);
   }
 
-  protected void setUp() {
-  }
-
-  protected void tearDown() {
-
-  }
-
   public void testFilterWorks() throws Exception {
     Directory dir = new RAMDirectory();
     IndexWriter writer = new IndexWriter(dir, new SimpleAnalyzer(), true);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermScorer.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermScorer.java
index d0388ab1..6aca86c9 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermScorer.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermScorer.java
@@ -21,7 +21,7 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -30,7 +30,7 @@
 import org.apache.lucene.index.Term;
 import org.apache.lucene.store.RAMDirectory;
 
-public class TestTermScorer extends TestCase
+public class TestTermScorer extends LuceneTestCase
 {
     protected RAMDirectory directory;
     private static final String FIELD = "field";
@@ -45,8 +45,9 @@ public TestTermScorer(String s)
         super(s);
     }
 
-    protected void setUp() throws IOException
+    protected void setUp() throws Exception
     {
+        super.setUp();
         directory = new RAMDirectory();
 
 
@@ -62,11 +63,6 @@ protected void setUp() throws IOException
         indexReader = indexSearcher.getIndexReader();
 
 
-    }
-
-    protected void tearDown()
-    {
-
     }
 
     public void test() throws IOException
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermVectors.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermVectors.java
index c31671b8..eab3e3e0 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermVectors.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestTermVectors.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -32,7 +32,7 @@
 import java.util.Map;
 import java.util.SortedSet;
 
-public class TestTermVectors extends TestCase {
+public class TestTermVectors extends LuceneTestCase {
   private IndexSearcher searcher;
   private RAMDirectory directory = new RAMDirectory();
   public TestTermVectors(String s) {
@@ -40,6 +40,7 @@ public TestTermVectors(String s) {
   }
 
   public void setUp() throws Exception {                  
+    super.setUp();
     IndexWriter writer
             = new IndexWriter(directory, new SimpleAnalyzer(), true);
     //writer.setUseCompoundFile(true);
@@ -69,10 +70,6 @@ else if (mod3 == 0){
     searcher = new IndexSearcher(directory);
   }
 
-  protected void tearDown() {
-
-  }
-
   public void test() {
     assertTrue(searcher != null);
   }
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestThreadSafe.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestThreadSafe.java
index 7534a0ee..0fc01884 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestThreadSafe.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestThreadSafe.java
@@ -17,6 +17,7 @@
  */
 
 import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 import org.apache.lucene.index.IndexReader;
@@ -32,7 +33,7 @@
  * 
  * @version $Id$
  */
-public class TestThreadSafe extends TestCase {
+public class TestThreadSafe extends LuceneTestCase {
   Random r = new Random();
   Directory dir1;
   Directory dir2;
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/TestWildcard.java b/lucene/java/trunk/src/test/org/apache/lucene/search/TestWildcard.java
index 26e9a16f..ecc2be49 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/TestWildcard.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/TestWildcard.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.SimpleAnalyzer;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
@@ -38,7 +38,7 @@
  * 
  */
 public class TestWildcard
-    extends TestCase {
+    extends LuceneTestCase {
   public void testEquals() {
     WildcardQuery wq1 = new WildcardQuery(new Term("field", "b*a"));
     WildcardQuery wq2 = new WildcardQuery(new Term("field", "b*a"));
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/function/FunctionTestSetup.java b/lucene/java/trunk/src/test/org/apache/lucene/search/function/FunctionTestSetup.java
index 7c198464..d81969d9 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/function/FunctionTestSetup.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/function/FunctionTestSetup.java
@@ -26,12 +26,12 @@
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /**
  * Setup for function tests
  */
-public abstract class FunctionTestSetup extends TestCase {
+public abstract class FunctionTestSetup extends LuceneTestCase {
 
   /**
    * Actual score computation order is slightly different than assumptios
@@ -75,6 +75,7 @@ public FunctionTestSetup(String name) {
 
   /* @override */
   protected void tearDown() throws Exception {
+    super.tearDown();
     super.tearDown();
     dir = null;
     anlzr = null;
@@ -82,6 +83,7 @@ protected void tearDown() throws Exception {
 
   /* @override */
   protected void setUp() throws Exception {
+    super.setUp();
     // prepare a small index with just a few documents.  
     super.setUp();
     dir = new RAMDirectory();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/payloads/TestBoostingTermQuery.java b/lucene/java/trunk/src/test/org/apache/lucene/search/payloads/TestBoostingTermQuery.java
index bfb83c1f..4a4b9dcc 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/payloads/TestBoostingTermQuery.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/payloads/TestBoostingTermQuery.java
@@ -16,7 +16,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.*;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -32,7 +32,7 @@
 import java.io.IOException;
 import java.io.Reader;
 
-public class TestBoostingTermQuery extends TestCase {
+public class TestBoostingTermQuery extends LuceneTestCase {
   private IndexSearcher searcher;
   private BoostingSimilarity similarity = new BoostingSimilarity();
   private byte[] payloadField = new byte[]{1};
@@ -81,7 +81,8 @@ public Token next() throws IOException {
     }
   }
 
-  protected void setUp() throws IOException {
+  protected void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     PayloadAnalyzer analyzer = new PayloadAnalyzer();
     IndexWriter writer
@@ -104,11 +105,6 @@ protected void setUp() throws IOException {
     searcher.setSimilarity(similarity);
   }
 
-
-  protected void tearDown() {
-
-  }
-
   public void test() throws IOException {
     BoostingTermQuery query = new BoostingTermQuery(new Term("field", "seventy"));
     TopDocs hits = searcher.search(query, null, 100);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestBasics.java b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestBasics.java
index 2df1681b..68a6d6db 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestBasics.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestBasics.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 
@@ -44,10 +44,11 @@
  *
  * @author Doug Cutting
  */
-public class TestBasics extends TestCase {
+public class TestBasics extends LuceneTestCase {
   private IndexSearcher searcher;
 
   public void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     IndexWriter writer
       = new IndexWriter(directory, new SimpleAnalyzer(), true);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestNearSpansOrdered.java b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestNearSpansOrdered.java
index 1bbaa116..fd5890e1 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestNearSpansOrdered.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestNearSpansOrdered.java
@@ -34,9 +34,9 @@
 
 import org.apache.lucene.queryParser.QueryParser;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestNearSpansOrdered extends TestCase {
+public class TestNearSpansOrdered extends LuceneTestCase {
   protected IndexSearcher searcher;
 
   public static final String FIELD = "field";
@@ -44,10 +44,12 @@
     new QueryParser(FIELD, new WhitespaceAnalyzer());
 
   public void tearDown() throws Exception {
+    super.tearDown();
     searcher.close();
   }
   
   public void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     IndexWriter writer= new IndexWriter(directory, new WhitespaceAnalyzer(), true);
     for (int i = 0; i < docFields.length; i++) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpans.java b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpans.java
index a2b27a9e..9791df5a 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpans.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpans.java
@@ -26,16 +26,17 @@
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.io.IOException;
 
-public class TestSpans extends TestCase {
+public class TestSpans extends LuceneTestCase {
   private IndexSearcher searcher;
 
   public static final String field = "field";
 
   public void setUp() throws Exception {
+    super.setUp();
     RAMDirectory directory = new RAMDirectory();
     IndexWriter writer= new IndexWriter(directory, new WhitespaceAnalyzer(), true);
     for (int i = 0; i < docFields.length; i++) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpansAdvanced.java b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpansAdvanced.java
index e344ffc4..a9809920 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpansAdvanced.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/search/spans/TestSpansAdvanced.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -36,7 +36,7 @@
  *
  * @author Reece Wilton
  */
-public class TestSpansAdvanced extends TestCase {
+public class TestSpansAdvanced extends LuceneTestCase {
 
     // location to the index
     protected Directory mDirectory;;
@@ -52,6 +52,7 @@
      */
     protected void setUp() throws Exception {
         super.setUp();
+        super.setUp();
 
         // create test index
         mDirectory = new RAMDirectory();
@@ -65,6 +66,7 @@ protected void setUp() throws Exception {
     }
 
     protected void tearDown() throws Exception {
+        super.tearDown();
         searcher.close();
         mDirectory.close();
         mDirectory = null;
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestBufferedIndexInput.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestBufferedIndexInput.java
index 2df6b9f2..9b51c860 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestBufferedIndexInput.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestBufferedIndexInput.java
@@ -34,9 +34,9 @@
 import org.apache.lucene.search.TermQuery;
 import org.apache.lucene.util._TestUtil;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestBufferedIndexInput extends TestCase {
+public class TestBufferedIndexInput extends LuceneTestCase {
 	// Call readByte() repeatedly, past the buffer boundary, and see that it
 	// is working as expected.
 	// Our input comes from a dynamically generated/ "file" - see
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestHugeRamFile.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestHugeRamFile.java
index eae214b6..21060404 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestHugeRamFile.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestHugeRamFile.java
@@ -20,10 +20,10 @@
 import java.io.IOException;
 import java.util.HashMap;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 /** Test huge RAMFile with more than Integer.MAX_VALUE bytes. */
-public class TestHugeRamFile extends TestCase {
+public class TestHugeRamFile extends LuceneTestCase {
   
   private static final long MAX_VALUE = (long) 2 * (long) Integer.MAX_VALUE;
 
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestLock.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestLock.java
index f5f0ecfc..761221c0 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestLock.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestLock.java
@@ -56,9 +56,9 @@
 
 
 import java.io.IOException;
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestLock extends TestCase {
+public class TestLock extends LuceneTestCase {
 
     public void testObtain() {
         LockMock lock = new LockMock();
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestLockFactory.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestLockFactory.java
index 6c55354a..c7e7349e 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestLockFactory.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestLockFactory.java
@@ -17,7 +17,7 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import java.util.Hashtable;
 import java.util.Enumeration;
@@ -36,7 +36,7 @@
 import org.apache.lucene.search.Hits;
 import org.apache.lucene.analysis.WhitespaceAnalyzer;
 
-public class TestLockFactory extends TestCase {
+public class TestLockFactory extends LuceneTestCase {
 
     // Verify: we can provide our own LockFactory implementation, the right
     // methods are called at the right time, locks are created, etc.
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestMMapDirectory.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestMMapDirectory.java
index d68f6e02..062ce29e 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestMMapDirectory.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestMMapDirectory.java
@@ -17,10 +17,10 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.lang.reflect.Method;
 
-public class TestMMapDirectory extends TestCase {
+public class TestMMapDirectory extends LuceneTestCase {
 
   // Simply verify that if there is a method in FSDirectory
   // that returns IndexInput or a subclass, that
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/store/TestWindowsMMap.java b/lucene/java/trunk/src/test/org/apache/lucene/store/TestWindowsMMap.java
index 5f40d0da..c1012288 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/store/TestWindowsMMap.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/store/TestWindowsMMap.java
@@ -21,7 +21,7 @@
 import java.util.Random;
 import java.io.File;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.document.Document;
@@ -30,12 +30,13 @@
 import org.apache.lucene.search.IndexSearcher;
 import org.apache.lucene.store.FSDirectory;
 
-public class TestWindowsMMap extends TestCase {
+public class TestWindowsMMap extends LuceneTestCase {
 	
 	private final static String alphabet = "abcdefghijklmnopqrstuvwzyz";
 	private Random random;
 	
-	public void setUp() {
+	public void setUp() throws Exception {
+		super.setUp();
 		random = new Random();
 		System.setProperty("org.apache.lucene.FSDirectory.class", "org.apache.lucene.store.MMapDirectory");
 	}
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/util/LuceneTestCase.java b/lucene/java/trunk/src/test/org/apache/lucene/util/LuceneTestCase.java
index e69de29b..7ff6007c 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/util/LuceneTestCase.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/util/LuceneTestCase.java
@@ -0,0 +1,52 @@
+package org.apache.lucene.util;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import org.apache.lucene.index.ConcurrentMergeScheduler;
+import junit.framework.TestCase;
+
+/** Base class for all Lucene unit tests.  Currently the
+ *  only added functionality over JUnit's TestCase is
+ *  asserting that no unhandled exceptions occurred in
+ *  threads launched by ConcurrentMergeScheduler.  If you
+ *  override either <code>setUp()</code> or
+ *  <code>tearDown()</code> in your unit test, make sure you
+ *  call <code>super.setUp()</code> and
+ *  <code>super.tearDown()</code>.
+ */
+
+public class LuceneTestCase extends TestCase {
+
+  public LuceneTestCase() {
+    super();
+  }
+
+  public LuceneTestCase(String name) {
+    super(name);
+  }
+
+  protected void setUp() throws Exception {
+    ConcurrentMergeScheduler.setTestMode();
+  }
+
+  protected void tearDown() throws Exception {
+    if (ConcurrentMergeScheduler.anyUnhandledExceptions()) {
+      fail("ConcurrentMergeScheduler hit unhandled exceptions");
+    }
+  }
+}
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/util/TestBitVector.java b/lucene/java/trunk/src/test/org/apache/lucene/util/TestBitVector.java
index 74a28ce3..0433e67f 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/util/TestBitVector.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/util/TestBitVector.java
@@ -19,7 +19,7 @@
 
 import java.io.IOException;
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.store.RAMDirectory;
 
@@ -29,7 +29,7 @@
  * 
  * @version $Id$
  */
-public class TestBitVector extends TestCase
+public class TestBitVector extends LuceneTestCase
 {
     public TestBitVector(String s) {
         super(s);
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/util/TestPriorityQueue.java b/lucene/java/trunk/src/test/org/apache/lucene/util/TestPriorityQueue.java
index da2b1c62..2f5173de 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/util/TestPriorityQueue.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/util/TestPriorityQueue.java
@@ -18,10 +18,10 @@
  */
 
 import java.util.Random;
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
 public class TestPriorityQueue
-    extends TestCase
+    extends LuceneTestCase
 {
     public TestPriorityQueue(String name)
     {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/util/TestSmallFloat.java b/lucene/java/trunk/src/test/org/apache/lucene/util/TestSmallFloat.java
index 2a285a85..6aab1207 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/util/TestSmallFloat.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/util/TestSmallFloat.java
@@ -17,14 +17,14 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 import java.util.Random;
 
 /**
  * @author yonik
  * @version $Id$
  */
-public class TestSmallFloat extends TestCase {
+public class TestSmallFloat extends LuceneTestCase {
 
   // original lucene byteToFloat
   static float orig_byteToFloat(byte b) {
diff --git a/lucene/java/trunk/src/test/org/apache/lucene/util/TestStringHelper.java b/lucene/java/trunk/src/test/org/apache/lucene/util/TestStringHelper.java
index 6964d633..9793f56d 100644
--- a/lucene/java/trunk/src/test/org/apache/lucene/util/TestStringHelper.java
+++ b/lucene/java/trunk/src/test/org/apache/lucene/util/TestStringHelper.java
@@ -17,9 +17,9 @@
  * limitations under the License.
  */
 
-import junit.framework.TestCase;
+import org.apache.lucene.util.LuceneTestCase;
 
-public class TestStringHelper extends TestCase {
+public class TestStringHelper extends LuceneTestCase {
 
 
   public void testStringDifference() {
